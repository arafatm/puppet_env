---
puppet_enterprise::profile::mcollective::agent::activemq_brokers:
  - 'mom.puppetlabs.vm'

profiles::mom::node_groups:
  'PE Infrastructure':
    classes:
      'puppet_enterprise':
        'certificate_authority_host': "%{::servername}"
        'console_host': "%{::servername}"
        'console_port': '443'
        'database_host': "%{::servername}"
        'database_port': '5432'
        'database_ssl': 'true'
        'mcollective_middleware_hosts':
          - "%{trusted.certname}"
        'puppet_master_host': "%{::servername}"
        'puppetdb_database_name': 'pe-puppetdb'
        'puppetdb_database_user': 'pe-puppetdb'
        'puppetdb_host': "%{::servername}"
        'puppetdb_port': '8081'
  'PE PuppetDB':
    classes:
      'puppet_enterprise::profile::puppetdb': {}
    parent: 'PE Infrastructure'
    rule: ['or', ['=', 'name', "%{::servername}"]]
  'Production environment':
    classes: {}
    override_environment: true
    rule: []
  'PE MCollective':
    classes:
      'puppet_enterprise::profile::mcollective::agent': {}
    parent: 'PE Infrastructure'
    rule: ["and",["~",["fact","id"],"root|Administrator"],["~",["fact","aio_agent_version"],".+"]]
  'PE Master':
    classes:
      'pe_repo': {}
      'pe_repo::platform::el_6_x86_64': {}
      'pe_repo::platform::windows_x86_64': {}
      'roles::mom': {}
      'puppet_enterprise::profile::master': {}
      'puppet_enterprise::profile::master::mcollective': {}
      'puppet_enterprise::profile::mcollective::peadmin': {}
    parent: 'PE Infrastructure'
    rule: ['or', ['=', 'name', "%{::servername}"]]
  'PE ActiveMQ Broker':
    classes:
      'puppet_enterprise::profile::amq::broker': {}
    parent: 'PE Infrastructure'
    rule: ['or', ['=', 'name', "%{::servername}"]]
  'PE Agent':
    classes:
      'puppet_enterprise::profile::agent': {}
    parent: 'PE Infrastructure'
    rule: ['and', ['~', ['fact', 'aio_agent_version'], '.+']]
  'PE Certificate Authority':
    classes:
      'puppet_enterprise::profile::certificate_authority': {}
    parent: 'PE Infrastructure'
    rule: ['or', ['=', 'name', "%{::servername}"]]
  'PE Console':
    classes:
      'pe_console_prune':
        'prune_upto': 30
      'puppet_enterprise::license': {}
      'puppet_enterprise::profile::console': {}
    parent: 'PE Infrastructure'
    rule: ['or', ['=', 'name', "%{::servername}"]]
  'Repo Servers':
    classes:
      'profiles::base': {}
      'profiles::repo_server': {}
    rule: ['and', ['~', ['fact', 'pp_role'], 'repo_server']]
  'Web Servers':
    classes:
      'roles::web_server': {}
      'profiles::puppet_users': {}
    rule: ['and', ['~', ['fact', 'pp_role'], 'web_server']]
  'DB Servers':
    classes:
      'roles::db_server': {}
    rule: ['and', ['~', ['fact', 'pp_role'], 'db_server']]
  'Load Balancer':
    classes:
      'profiles::base': {}
      'profiles::lb_services': {}
    rule: ['and', ['~', ['fact', 'pp_role'], 'lb']]
  'Monitoring Servers':
    classes:
      'profiles::monitor_server': {}
    rule: ['and', ['~', ['fact', 'pp_role'], 'repo_server']]
profiles::mom::node_groups_defaults:
  ensure: present
  environment: production
  parent: 'All Nodes'

